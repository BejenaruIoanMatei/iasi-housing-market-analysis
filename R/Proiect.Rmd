---
title: "Piata Imobiliara din Iasi: Cand Locatia Depaseste Vechimea - Analiza de Regresie si Testare de Ipoteze"
subtitle: "Proiect realizat in cadrul disciplinei *Introducere in R*"
author: "Bejenaru Ioan-Matei"
date: "2026-01-06"
output: pdf_document
---

# Exploratory Analysis

### Introducere

Obiectivul proiectului:

- Analiza mecanismelor de formare a pretului pe piata imobiliara din Iasi. Cercetarea se concentreaza pe identificarea si cuantificarea relatiilor de dependenta dintre pretul de vanzare al apartamentelor (variabila dependenta) si principalii factori de influenta, cum ar fi suprafata utila, numarul de camere (variabile independente).

Vom folosi setul de date obtinut prin scraping si curatat in notebooks/2_data_cleaning_etl.ipynb (toti pasii urmati pentru a curata setul de date sunt explicati in acest notebook)

```{r}
library(dplyr)
```

Incarcarea setului de date:

```{r}
df <- read.csv('../data/processed/2_clean_data.csv')

head(df, n = 5)
```
### Prezentarea bazei de date

Datele folosite sunt reale, obtinute din anunturi imobiliare de pe Storia, prin web scraping.

Esantionul cu care vom lucra contine 520 de observatii si 7 variabile.

**Structura bazei de date**:

- **Pret (numeric)**: pretul apartamentului, in euro. Este variabila pe care dorim sa o explicam.

- **Suprafata_Utila (numeric)**: suprafata apartamentului, in metri patrati. In mod intuitiv, se asteapta o corelatie pozitiva puternica cu pretul.

- **Camere (numeric/factor)**: numarul de camere. Variabila va fi tratata ca numeric pentru a permite calculul coeficientilor de corelatie bivariata si testarea liniaritatii.

- **Pret_mp (numeric)**: pretul pe metru patrat, obtinut prin (Pret / Suprafata Utila)

- **Zona (factor)**: o zona din Iasi, de exemplu "Nicolina-CUG", "Bucium", "Alexandru-Dacia"

- **Vechime_Imobil (factor)**: variabila obtina prin transformarea unei variabile numerice intr-o variabila categoriala, cu cel putin 3 categorii: "Vechi (Pre-1977)", "Clasic (1977-2000)", "Nou (Post-2000)"

- **Compartimentare (factor)**: Decomandat, Semidecomandat, Nespecificat. Vom elimina aceasta variabila imediat.

- **Tip_Zona (factor)**: Premium ('Copou-Saras', 'Centru-Civic'), Standard/Urban ('Tatarasi-Tudor', 'Podu-Ros-Cantemir', 'Pacurari-Canta', 'Alexandru-Dacia'), Accesibil/Rezidential ('Nicolina-CUG', 'Galata-Frumoasa')

In cazul de fata coloana **X** contine indicii ramasi in urma curatarii deci va trebui sa o scoatem. Coloana **Compartimentare** a fost pastrata pentru a demonstra limitarile scraping-ului, foarte multe observatii fiind de tipul "Nespecificat" deoarece scraping-ul s-a realizat pe pagina principala cu anunturile si descrierile anunturilor erau doar un preview. Ca sa fi accesat intreaga descriere trebuie deschis fiecare anunt in parte si extras continutul.

```{r}
names(df)
```

```{r}
glimpse(df)
```

```{r}
dim(df)
```
Eliminam coloanele mentionate mai sus:

```{r}
drops <- c("X", "Compartimentare")
df <- df[,!(names(df) %in% drops )]
```

```{r}
dim(df)
```

```{r}
glimpse(df)
```

Vrem sa transformam variabilele de tip chr in factor, pentru a le trata corect in analizele statistice si in modelele de regresie. "Zona", "Vechime_Imobil", "Tip_Zona" sunt gandite sa fie de tip factor.

```{r}
df$Zona <- as.factor(df$Zona)
df$Vechime_Imobil <- as.factor(df$Vechime_Imobil)
df$Tip_Zona <- as.factor(df$Tip_Zona)
```

```{r}
glimpse(df)
```

Mult mai bine, acum tipul variabilelor este cel corect.

```{r}
summary(df$Pret)
```

```{r}
summary(df$Suprafata_Utila)
```

```{r}
summary(df$Camere)
```

OBS:

- Avem apartamente pana in 3 camere

- Setul de date a fost explorat si curatat anterior

```{r}
hist(df$Pret, breaks=20, main="Distributia Preturilor", col="skyblue")
```

Distributia este apropiata de una normala, dar usor asimetrica spre dreapta.

Traducere:

- Sunt cateva preturi mai mari care trag coada spre dreapta

Zona centrala (intervalul de pret standard/cel mai frecvent):

- Majoritatea valorilor sunt intre 70-130 de mii

- Varful distributiei pare in jur de 90-100 de mii

Valori extreme/outlieri:

- Exista cateva valori mici (40-50 mii), dar si valori foarte mari (160-200 mii)

- Nu par outlieri extrem de agresivi (nu sunt erori), dar preturile mari sunt mai rare

Implicatii statistice:

- Media probabil este putin mai mare decat mediana, din cauza asimetriei spre dreapta

```{r}
mean(df$Pret)
median(df$Pret)
```

Se confirma ideea, media fiind 100 mii in timp ce mediana 98 de mii


```{r}
boxplot(df$Pret, main = "Identificare outlieri Pret", horizontal = T)
```

In curatarea anterioara s-a folosit Interquartile Range (IQR) pentru detectarea outlierilor de Pret.

Aceeasi metoda s-a folosit si pentru detectarea outlierilor de Suprafata_Utila, Camere, Pret_mp.

Au fost eliminate apartamentele cu o suprafata utila mai mica de 40mp, dar cu un pret mai mare de 75 de mii de euro (apartamente mici, dar neobisnuit de scumpe). La fel si apartamentele cu o suprafata utila mai mare de 80mp, dar cu un pret mai mic de 130 mii (apartamente mari, dar neobisnuit de ieftine).

Aceasta etapa documentata in fisierul *2_data_cleaning_etl.ipynb* (sectiunile IQR si Outlieri) a avut ca scop cresterea robustetii modelelor de regresie prin eliminarea zgomotului din date.

```{r}
boxplot(df$Pret_mp, main = "Identificare outlieri Pret_mp", horizontal = T)
```

```{r}
boxplot(df$Camere, main = "Identificare outlieri Camere", horizontal = T)
```

```{r}
boxplot(df$Suprafata_Utila, main = "Identificare outlieri Suprafata_Utila", horizontal = T)
```

hist(df$Pret, breaks=20, main="Distributia Preturilor", col="skyblue")

```{r}
hist(df$Camere, breaks = 10, main="Distributia numarului de camere")
```

Piata este dominata de apartamente cu 2 camere, cele cu 3 camere fiind a doua cea mai frecventa categorie.

Interpretare practica:

- Oferta in Iasi este orientata catre:

  - Cupluri/familii mici (2 camere)
  
  - Intr-o masura mai mica, familii mai mari (3 camere)
  
Frecventa absoluta:

```{r}
table(df$Camere)
```

Frecventa relativa:

```{r}
prop.table(table(df$Camere))
```

Jumatate (50%) din numarul de oferte sunt apartamente de 2 camere.

### Analiza variabilelor categoriale

Analiza frecventei pentru Tip_Zona:

```{r}
tab_zona <- table(df$Tip_Zona)
barplot(tab_zona, main="Distributia ofertelor pe Tip de Zona", las=2)
```

```{r}
tab_zona <- table(df$Zona)
barplot(tab_zona, main="Distributia ofertelor pe Tip de Zona", las=2)
```

Se observa cum pentru unele zone nu sunt destule observatii, cum ar fi "Periferie-Metropolitana", "Bucium".

### Cum s-a realizat maparea la zone:

'Nicolina-CUG': ['Nicolina 1', 'Nicolina 2', 'CUG', 'Hlincea', 'Tudor Neculai', 'Soseaua Nicolina', 'Poitiers', 'Manta Rosie'],

'Centru-Civic': ['Centru', 'Palas', 'Independentei', 'Academiei', 'Ion Creanga', 'Carol I', 'Anastasie Panu', 'Cuza Voda', 'Arcu', 'Smardan', 'Podu de Fier'],

'Podu-Ros-Cantemir': ['Podu Ros', 'Cantemir', 'Tesatura'],

'Tatarasi-Tudor': ['Tatarasi Sud', 'Tatarasi Nord', 'Vasile Lupu', 'Oancea', 'Tudor Vladimirescu', 'Baza 3'],

'Pacurari-Canta': ['Pacurari', 'Canta', 'Moara de Foc'],

'Copou-Saras': ['Copou', 'Agronomie', 'Sadoveanu', 'Agronomilor', 'Moara de Vant', 'Ticau'],

'Alexandru-Dacia': ['Alexandru Cel Bun', 'Dacia', 'Mircea cel Batran', 'Bularga', 'Decebal'],

'Bucium': ['Bucium', 'Visan', 'Barnova'],

'Galata-Frumoasa': ['Galata', 'Frumoasa', 'Ciurea', 'Bisericii'],

'Periferie-Metropolitana': ['Miroslava', 'Rediu', 'Dancu', 'Aroneanu', 'Valea Lupului', 'Voinesti']
    
### Variabila "Tip_Zona"

- Premium: Copou-Saras, Centru-Civic

- Standard/Urban: Tatarasi-Tudor, Podu-Ros-Cantemir, Pacurari-Canta, Alexandru-Dacia

- Accesibil/Rezidential: Nicolina-CUG, Galata-Frumoasa

- Periferie: Bucium, Periferie-Metropolitana

### De ce ?

In statistica, pentru ca un grup sa fie relevant, este recomandat sa aiba macar 30 de observatii sau macar un numar apropiat. In cazul nostru sunt cateva sub 30 de observatii, dar care ar putea fi grupate in zone mai generale pentru a creste numarul de observatii.

### Proportii vechime imobil:

```{r}
prop.table(table(df$Vechime_Imobil))
```

Cea mai mare majoritate a blocurilor sunt clasice (perioada 1977-2000), urmand cele Noi (>2000)

# Analiza de regresie

## Regresie liniara simpla

### Scopul analizei:

- Vrem sa vedem impactul suprafetei utile (variabila independenta) asupra pretului apartamentului (variabila dependenta)

```{r}
regresie_simpla <- lm(Pret ~ Suprafata_Utila, data = df)
```

```{r}
summary(regresie_simpla)
```

## Interpretarea rezultatelor

### 1.  Estimarea si testarea raportului de determinatie (R squared):

- R squared = 0.7404, adica 74% din variatia pretului este explicata de suprafata utila

- Testarea acestuia este confirmata de F-statistic: 1477 cu un p-value < 2.2e-16, adica raportul de determinatie este semnificativ statistic (modelul este util)


### 2.  Scrierea ecuatiei estimate:

- Pret = 6486.05 + 1741.96 * Suprafata_Utila

### 3.  Interpretarea parametrilor:

- Intercept = 6486.05 - valoarea teoretica a pretului pentru o suprafata de 0 mp 

- Suprafata_Utila = 1741.96 - la fiecare mp adaugat, pretul apartamentului creste in medie cu 1741.96 euro

### 4.  Testarea semnificatiei parametrilor:

- Pentru coeficientul suprafetei, valoarea t = 38.434 si p < 2e-16 < 0.05, indica faptul ca suprafata este un predictor semnificativ

### 5. Testarea modelului:

Testarea semnificatiei globale (testul F)

- Ipoteza nula H0: Toti coeficientii (in afara de intercept) sunt 0 (modelul nu e bun)

- Ipoteza alternativa H1: Cel putin un coeficient este diferit de 0

- Rezultat: p-value < 2.2e-16 < 0.05, respingem H0.

- Concluzie: Cu un risc asumat de 5%, cel putin un coeficient este diferit de 0, modelul fiind valid statistic

Testarea ipotezelor pe reziduuri (Teste formale)

a.  Testul pentru normalitate (Shapiro-Wilk)

```{r}
shapiro.test(residuals(regresie_simpla))
```

- Ipoteza nula H0: reziduurile sunt distribuite normal

- Ipoteza alternativa H1: reziduurile nu sunt distribuite normal

- Rezultat: p-value = 0.02 < 0.05, respingem H0.

- Concluzie: Cu un risc asumat de 5%, reziduurile nu urmeaza o distributie normala, abaterea fiind relevanta din punct de vedere statistic

- W = 0.99365 apropiat de 1, ceea ce sugereaza abateri minore de la normalitate

Totusi, avand in vedere dimensiunea mare a esantionului (520 observatii) si faptul ca statistica W este apropiata de 1, abaterea de la normalitate este redusa si nu afecteaza semnificativ validitatea modelului.

b.  Verificarea omoscedasticitatii (grafic reziduuri vs valori estimate)

```{r}
plot(regresie_simpla$fitted.values, residuals(regresie_simpla),
     xlab = "Valori estimate",
     ylab = "Reziduuri")
abline(h = 0, col = "red")
```

Liniaritatea modelului:

- Reziduurile sunt distribuite in jurul valorii 0 (linia rosie)

- Nu apare un tipar clar (nu pare sa fie forma de U sau curba)

- Majoritatea punctelor sunt relativ simetric dispuse deasupra si sub axa 0

Problema minora:

- Pentru valori estimate mai mari (dreapta graficului), dispersia reziduurilor scade (usoara forma de evantai). Posibil ca variatia reziduurilor sa nu fie perfect constanta

### 6.  Identificarea punctelor de influenta si grafice pentru reziduuri:

```{r}
cooks_d <- cooks.distance(regresie_simpla)

plot(cooks_d, type = "h", main = "Distanta Cook pentru Modelul Simplu", 
     ylab = "Distanta Cook", xlab = "Indice Observatie")
abline(h = 4/nrow(df), col = "red", lty = 2)
```

- Axa X (Indice Observatie) - fiecare apartament individual din baza mea de date (1-520)

- Axa Y (Distanta Cook) - masoara cat de mult se schimba coeficientii modelului daca acea observatie ar fi eliminata. Cu cat bara este mai inalta cu atat impactul acelui apartament asupra liniei de regresie este mai mare

- Linia rosie (Pragul Critic) - este setata la 4/n (n = 520). Orice bara care trece de aceasta linie este considerata un punct de influenta (din punct de vedere statistic).

Undeva la 10-15 observatii sar mult peste linia rosie (pragul critic). Cu aproximatie 20 de observatii trec pragul.

- Aceste puncte de influenta nu sunt neaparat erori, ci niste apartamente atipice. De exemplu:

  - Putem avea un apartament foarte mic dar intr-o zona extrem de buna, care are un pret de vanzare cu mult peste cat ar valora altele de aceeasi suprafata
  
  - Putem avea un penthouse de lux care are un pret atat de mare incat trage linia de regresie in sus, alterand estimarea pentru restul apartamentelor obisnuite
  
Vom pastra aceste valori deoarece reprezinta tranzactii reale pe piata din Iasi, insa prezenta lor explica de ce modelul ar putea avea erori mai mari in segmentele de pret extrem.

```{r}
plot(regresie_simpla)
```

### Important

Desi in primul grafic apareau multe observatii peste linia rosie, graficul Residuals vs Leverage demonstreaza ca acele puncte nu strica modelul:

  - Absenta zonelor critice: Toate observatiile sunt grupate in partea stanga, departe de zonele de pericol din colturile din dreapta sus/jos
  
  - Punctele etichetate (67, 251, 501): R eticheteaza automat cele mai extreme puncte. Chiar daca observatia 67 are un leverage mai mare si observatiile 251 si 501 au reziduuri mai mari, ele nu au o combinatie destul de puternica de ambele pentru a devia linia de regresie
  
  - Linia rosie: este aproape perfect orizontala si suprapusa peste linia punctata de la 0. Acest lucru indica faptul ca nu exista un tipar sistematic de eroare si ca modelul este stabil.
  
Asadar, modelul este robust si poate fi folosit pentru predictie fara sa eliminam observatiile care depasesc pragul teoretic de 4/n. 

## Regresie liniara multipla

Scopul analizei:

- Imbunatatirea capacitatii de predictie a modelului prin introducerea factorilor de control: numarul de camere (Camere) si locatia (Tip_Zona)

```{r}
regresie_multipla <- lm(Pret ~ Suprafata_Utila + Camere + Tip_Zona, data = df)
```

```{r}
summary(regresie_multipla)
```

## Interpretarea rezultatelor

### 1. Estimarea si testarea raportului de determinatie (R squared):

- R squared = 0.7642 - comparativ cu 0.7404 (Modelul de regresie liniara simpla), modelul multiplu explica mai bine pretul (76% fata de 74%)

- Adjusted R squared = 0.7619 - la regresia multipla ne uitam la acest parametru pentru ca el penalizeaza adaugarea de variabile care nu aduc valoare informationala. In cazul de fata, variabilele aduc valoare informationala.

### 2. Scrierea ecuatiei estimate:

- Pret = 6093.97 + 1581.96 * Suprafata_Utila + 3673.63 * Camere - 6599.21 * Periferie + 11258.40 * Premium + 124.25 * Standard, unde Periferie, Premium si Standard sunt categoriile variabilei Tip_Zona.

- Variabila de referinta: Categoria Accesibil/Rezidential a fost aleasa ca punct de referinta. Intercept-ul (6093.97) reprezinta baza de pret pentru aceasta zona.

### 3. Interpretarea parametrilor:

- Intercept (6093.97): Baza de pret pentru zona aleasa ca punct de referinta (Accesibil/Rezindential)

- Suprafata Utila (1581.96): Pentru fiecare mp in plus pretul creste cu 1581.96, mentinand restul variabilelor constante

- Camere (3673.63): Fiecare camera suplimentara adauga in medie 3673.63 euro la pretul apartamentului

- Zona Periferie (- 6599.21): Un apartament la periferie este in medie mai ieftin cu aproximativ 6600 de euro decat unul intr-o zona accesibila precum [Nicolina-CUG, Galata-Frumoasa].

- Zona Premium (11258.40): Un apartament intr-o zona premium este cu 11 mii de euro mai scump decat unul similar dar intr-o zona accesibila.

- Zona Standard(124.25): Un apartament standard este similar la pret cu unul accesibil, diferenta fiind doar de 124 de euro.

- OBS:

  - Zona Standard/Urban are p-value = 0.9 > 0.05. Statistic vorbind, nu exista o diferenta semnificativa de pret intre zona standard si cea accesibila.

### 4. Testarea semnificatiei parametrilor

- Ipoteza nula H0: toti coeficientii sunt 0 inafara de intercept (variabilele nu conteaza)

- Ipoteza alternativa H1: cel putin un coeficient este diferit de 0 (macar o variabila conteaza)

Daca p-value < 0.05 respingem H0, din punct de vedere statistic variabila are semnificatie, avand un impact asupra pretului.

La un prag de semnificatie de 0.05:

- Intercep = 0.02 < 0.05, Semnificativ

- Suprafata_Utila < 2e-16, Foarte Semnificativ

- Camere = 0.02 < 0.05, Semnificativ

- Tip_ZonaPeriferie = 0.01 < 0.05, Semnificativ

- Tip_ZonaPremium < 3.8e-08, Foarte Semnificativ

- Tip_ZonaStandard/Urban = 0.9 > 0.05, Deloc Semnificativ

Concluzii asupra parametrilor:

- Suprafata_Utila si Tip_ZonaPremium sunt cei mai puternici predictori ai pretului, avand cele mai mici p-values.

- Camere si Tip_ZonaPeriferie sunt la fel niste predictori valizi din punct de vedere statistic (au p-values < 0.05)

### 5. Testarea modelului

Testarea semnificatiei globale (Testul F):

- F-statistic = 333.2 cu un p-value < 2.2e-16 < 0.05

- Interpretare:

  - p-value este mult mai mic decat 0.05, asadar modelul este valid statistic. Cel putin una din variabilele incluse explica in mod real variatia pretului
  
Testarea ipotezelor pe reziduuri (Teste formale):

a.  Testul pentru normalitate (Shapiro-Wilk)

```{r}
shapiro.test(residuals(regresie_multipla))
```

- Ipoteza nula H0: reziduurile sunt distribuite normal

- Ipoteza alternativa H1: reziduurile nu sunt distribuite normal

- Rezultat: p-value = 0.01743 < 0.05, respingem H0.

- Concluzie: Cu un risc asumat de 5%, reziduurile nu urmeaza o distributie normala, abaterea fiind relevanta din punct de vedere statistic

- W = 0.99365 apropiat de 1, ceea ce sugereaza abateri minore de la normalitate

Totusi, avand in vedere dimensiunea mare a esantionului (520 observatii) si faptul ca statistica W este apropiata de 1, abaterea de la normalitate este redusa si nu afecteaza semnificativ validitatea modelului.

b. Verificarea omoscedasticitatii (grafic reziduuri vs valori estimate)

```{r}
plot(regresie_multipla$fitted.values, residuals(regresie_multipla),
     xlab = "Valori estimate",
     ylab = "Reziduuri")
abline(h = 0, col = "red")
```

Liniaritatea modelului:

- Reziduurile sunt distribuite in jurul valorii 0 (linia rosie)

- Nu apare un tipar clar (nu pare sa fie forma de U sau curba)

- Majoritatea punctelor sunt relativ simetric dispuse deasupra si sub axa 0

Problema minora:

- Pentru valori estimate mai mari (dreapta graficului), dispersia reziduurilor scade (usoara forma de evantai). Posibil ca variatia reziduurilor sa nu fie perfect constanta

### 6. Identificarea punctelor de influenta si grafice pentru reziduuri:

```{r}
cooks_d <- cooks.distance(regresie_multipla)

plot(cooks_d, type = "h", main = "Distanta Cook pentru Modelul Multiplu", 
     ylab = "Distanta Cook", xlab = "Indice Observatie")
abline(h = 4/nrow(df), col = "red", lty = 2)
```

Interpretare:

- Observam in jur de 30 de puncte care depasesc pragul critic (linia rosie). Aceste puncte reprezinta apartamente atipice care au un impact mai mare asupra coeficientilor modelului. Exemple ar putea fi urmatoarele cazuri:

  - Apartamente mici intr-o zona premium cu preturi mult peste medie
  
  - Apartamente mari in zone periferice cu preturi neasteptat de mari
  
  - Penthouse-uri cu finisaje de lux la periferie
  
Vom pastra aceste observatii deoarece reprezinta apartamente reale pe piata imobiliara din Iasi, chiar daca introduc variabilitate in model.

```{r}
plot(regresie_multipla)
```

1.  Residuals vs Fitted:

- Reziduurile sunt distribuite relativ uniform in jurul liniei de la 0

- Nu se observa o forma clara (U sau curba), ceea ce confirma liniaritatea

- Usoara dispersie mai mare la valori estimate ridicate (usoara forma de evantai), dar nu e ingrijorator (e un efect similar cu cel de la modelul anterior)

2. Normal Q-Q:

- Majoritatea punctelor se afla pe diagonala, sugerand o distributie aproape normala

- Cateva abateri minore in cozile distributiei (punctele 88, 251, 501)

- In contextul unui esantion de 520 de observatii, acele mici abateri nu afecteaza validitatea modelului

3. Scale-Location:

- Linia nu este perfect orizontala, indicatie ca variabilitatea reziduurilor creste odata cu pretul estimat (semn de heteroscedasticitate moderata)

- Dispersie mai mare la valori mari ale pretului

  - Pentru preturi mai mici (40-80 mii) reziduurile sunt mai concentrate
  
  - Pentru preturi mai mari (120+ mii) dispersia este mai mare
  
  - Modelul face erori mai mari pentru apartamentele scumpe
  
4.  Residuals vs Leverage:

- Majoritatea observatiilor sunt concentrate in partea stanga a graficului (leverage mic) si au reziduuri standardizate intre -2 si 2. Modelul pare sa fie stabil pentru marea majoritate a datelor

- Sunt cateva puncte intre 0.02 si 0.045, care corespund probabil unor apartamente:

  - super mari
  
  - combinatii rare (foarte mari + zona premium)
  
- Observatiile etichetate (88, 5, 275) au fie leverage mai mare, fie reziduuri mai mari, dar nu ambele simultan. Observatia 275 pare sa aiba un leverage moderat si un reziduu pozitiv (posibil sa fie o observatie usor influenta).

- Nicio observatie nu depaseste limitele Cook (nu exista valori cu D > 1)

### Mica concluzie

Modelul multiplu este robust si respecta ipotezele de baza ale regresiei liniare.

  - Punctele de influenta identificate nu compromit validitatea modelului si pot fi pastrate in analiza.
  
Modelul poate fi folosit pentru predictie.

### Tabel comparativ cu cele doua modele

```{r}
data.frame(
     Model = c("Simplu", "Multiplu"),
     R_squared = c(0.7404, 0.7642),
     Adj_R_squared = c(0.7399, 0.7619),
     F_statistic = c(1477, 333.2),
     Variabile = c("Suprafata_Utila", "Suprafata_Utila + Camere + Tip_Zona")
   )
```

# Analiza de corelatie

##  Estimarea coeficientilor de corelatie bivariati

### Scopul analizei:

- Identificarea si cuantificarea relatiilor liniare dintre variabilele numerice: Pret, Suprafata_Utila, Camere

- Cum Pret_mp este obtinut prin Pret/Suprafata_Utila, inseamna ca este o variabila determinist derivata din alte doua care vor fi incluse in matricea de corelatie. Asadar, nu ar fi corect sa punem si Pret_mp in matrice daca includ deja Pret si Suprafata_Utila.

- Determinarea intensitatii si directiei acestor relatii

Pentru inceput, vom selecta variabilele numerice din setul de date si vom calcula matricea de corelatie

```{r}
df %>%
  select(Pret) %>%
  head(n = 5)
```
```{r}
glimpse(df)
```

```{r}
var_numerice <- df %>% select(Pret, Suprafata_Utila, Camere)
```

```{r}
head(var_numerice, n = 5)
```

Matricea de corelatie:

```{r}
cor(var_numerice)
```

### Interpretarea coeficientilor de corelatie:

- Coeficientul de corelatie (r) masoara intensitatea si directia relatiei liniare dintre doua variabile:

  - r > 0: corelatie pozitiva (una creste, cealalta creste)
  
  - r < 0: corelatie negativa (una creste, cealalta scade)
  
  - |r| apropiat de 1: corelatie puternica
  
  - |r| apropiat de 0.5: corelatie medie
  
  - |r| apropiat de 0: corelatie slaba sau absenta
  
### Interpretarea valorilor estimate

1.  Pret - Suprafata_Utila

  - r = 0.86 
  
  - Corelatie pozitiva puternica (apropiat de 1), indicand ca apartamentele mari au preturi mari
  
  - La cresterea suprafetei, pretul tinde sa creasca proportional
  
2.  Pret - Camere

  - r = 0.71
  
  - Corelatie pozitiva puternica (apropiat de 1), indicand ca apartamentele cu mai multe camere sunt mai scumpe
  
  - Relatie mai slaba decat cea cu suprafata, deoarece numarul de camere nu cuprinde intreaga dimensiune a apartamentului
  
3. Suprafata_Utila - Camere

  - r = 0.80
  
  - Corelatie pozitiva puternica (apropiat de 1), indicand ca apartamentele mari au mai multe camere
  
  - O relatie destul de logica si intuitiva pe piata imobiliara
  
  
```{r}
library(corrplot)
```
Pentru a vizualiza mai bine:

```{r}
corrplot(cor(var_numerice), method = "circle", type = "upper", 
         tl.col = "black", tl.srt = 45,
         addCoef.col = "white", number.cex = 0.7,
         title = "Matricea de Corelatie - Variabile Numerice",
         mar = c(0,0,2,0))
```

- Cercurile mari si inchise la culoare indica corelatii puternice

- Cercurile mici indica corelatii slabe

- Albastru = corelatie pozitiva

- Rosu = corelatie negativa

Dupa cum se poate vedea toate corelatiile sunt pozitive, puternice (0.86, 0.80, 0.71).

Scatterplot pentru cea mai importanta relatie, Pret - Suprafata_Utila:

```{r}
plot(df$Suprafata_Utila, df$Pret, 
     xlab = "Suprafata Utila (mp)", 
     ylab = "Pret (EUR)",
     main = "Relatia dintre Suprafata si Pret",
     pch = 19, col = "steelblue")
abline(lm(Pret ~ Suprafata_Utila, data = df), col = "red", lwd = 2)
```

Graficul confirma vizual corelatia puternica pozitiva dintre Pret si Suprfata Utila, punctele fiind concentrate in jurul liniei de regresie, ceea ce sugereaza o relatie liniara clara.

## Testarea coeficientilor de corelatie bivariati

### Scopul analizei:

- Testarea semnificatiei statistice a coeficientilor de corelatie

- Determinarea daca relatiile observate sunt semnificative statistic sau doar pura intamplare

### Testarea corelatiei Pret - Suprafata_Utila

```{r}
cor.test(df$Pret, df$Suprafata_Utila)
```

Implicit se foloseste Pearson ca method.

### Interpretare

- Ipoteze:

  - Ipoteza nula H0: Nu exista corelatie liniara intre Pret si Suprafata_Utila, adica r = 0

  - Ipoteza alternativa H1: Exista corelatie liniara, adica r != 0

- Coeficientul de corelatie estimat: r = 0.8604509, valoare pozitiva foarte puternica

- Testul de semnificatie (t-test pentru corelatie): 

  - t = 38.434
  
  - p-value < 2.2e-16 < 0.05
  
  - H0: nu exista corelatie in populatie
  
  - H1: exista corelatie
  
  - Cum p-value < 0.05 respingem H0. Cu un risc asumat de 5%, exista o corelatie liniara pozitiva semnificativa statistic intre Pret si Suprafata_Utila.
  
Ca interpretare economica:

- Apartamentele cu suprafata mai mare tind sa aiba preturi semnificativ mai mari

### Testarea corelatiei Pret - Camere

```{r}
cor.test(df$Pret, df$Camere)
```

### Interpretare

- Ipoteze:

  - Ipoteza nula H0: Nu exista corelatie liniara intre Pret si Camere, adica r = 0

  - Ipoteza alternativa H1: Exista corelatie liniara, adica r != 0

- Coeficientul de corelatie estimat: r = 0.7136459, valoare pozitiva foarte puternica

- Testul de semnificatie (t-test pentru corelatie): 

  - t = 23.187
  
  - p-value < 2.2e-16 < 0.05
  
  - H0: nu exista corelatie in populatie
  
  - H1: exista corelatie
  
  - Cum p-value < 0.05 respingem H0. Cu un risc asumat de 5%, exista o corelatie liniara pozitiva semnificativa statistic intre Pret si Camere.
  
Ca interpretare economica:

- Apartamentele cu mai multe camere tind sa aiba preturi semnificativ mai mari

### Testarea corelatiei Suprafata_Utila - Camere

```{r}
cor.test(df$Suprafata_Utila, df$Camere)
```

### Interpretare

- Ipoteze:

  - Ipoteza nula H0: Nu exista corelatie liniara intre Suprafata_Utila si Camere, adica r = 0

  - Ipoteza alternativa H1: Exista corelatie liniara, adica r != 0

- Coeficientul de corelatie estimat: r = 0.8021293, valoare pozitiva foarte puternica

- Testul de semnificatie (t-test pentru corelatie): 

  - t = 30.572
  
  - p-value < 2.2e-16 < 0.05
  
  - H0: nu exista corelatie in populatie
  
  - H1: exista corelatie
  
  - Cum p-value < 0.05 respingem H0. Cu un risc asumat de 5%, exista o corelatie liniara pozitiva semnificativa statistic intre Suprafata_Utila si Camere.
  
Ca interpretare economica:

- Apartamentele cu o suprafata mai mare tind sa aiba mai multe camere.

### Observatie importanta

```{r}
num_cols <- c("Pret", "Suprafata_Utila", "Camere", "Pret_mp")

corr_matrix <- cor(df[, num_cols])

corrplot(corr_matrix,
         method = "color",
         type = "upper",
         addCoef.col = "black",
         number.cex = 0.8,
         tl.col = "black",
         tl.srt = 45,
         col = colorRampPalette(c("blue", "white", "red"))(200),
         title = "Matricea de corelatie Pearson",
         mar = c(0, 0, 2, 0))

```

- Corelatie negativa intre Suprafata_Utila si Pret_mp ?

  - De ce ?

    - Cu cat un apartament este mai mare, cu atat pretul pe mp tinde sa scada usor

    - O garsoniera de 25 mp are costuri de constructie si finisare concentrate pe o suprafata mica, deci se vinde cu un pret pe mp mai mare. Un apartament cu 60 mp distribuie aceleasi costuri fixe pe mai multi mp de spatiu gol, ceea ce face ca media pe mp sa fie mai mica

    - De ce este o valoare mica (0.11) ? Pentru ca in Iasi sunt multe apartamente mari in zone de lux (Copou, Centru) care au pret pe mp foarte mare, ceea ce trage corelatia inapoi spre zero

    
```{r}
accesibil <- df[df$Tip_Zona == "Accesibil/Rezidential", ]

corr_matrix <- cor(accesibil[, num_cols])

corrplot(corr_matrix,
         method = "color",
         type = "upper",
         addCoef.col = "black",
         number.cex = 0.8,
         tl.col = "black",
         tl.srt = 45,
         col = colorRampPalette(c("blue", "white", "red"))(200),
         title = "Matricea de corelatie Pearson – Zona Accesibil/Rezidential",
         mar = c(0, 0, 2, 0))

```
    
Facand matricea de corelatie pentru apartamentele din zona Accesibil/Rezidential, se confirma ideea ca apartamentele de lux trag corelatia inapoi spre 0

- Impreuna cu cele de lux: -0.11

- Doar cu cele accesibile: -0.26

### O alta observatie importanta

Vom testa diferenta dintre doua medii (esantioane independente): Apartamente Noi vs Vechi

```{r}
table(df$Vechime_Imobil)
```

```{r}
pret_noi <- df$Pret_mp[df$Vechime_Imobil == "Nou (Post-2000)"]

pret_vechi <- df$Pret_mp[df$Vechime_Imobil == "Vechi (Pre-1977)"]
```

```{r}
length(pret_noi)
```

```{r}
length(pret_vechi)
```

Inainte de a alege testul t potrivit, verificam daca variantele celor doua grupuri sunt egale (ipoteza de omogenitate a variantelor)

```{r}
library(car)
```

```{r}
leveneTest(Pret_mp ~ Vechime_Imobil,
           data = df,
           subset = Vechime_Imobil %in% c("Nou (Post-2000)", "Vechi (Pre-1977)"))
```

- H0: Variantele sunt egale (exista omogenitate)

- H1: Variantele nu sunt egale

- p-value = 1.516e-08 < 0.05, respingem H0

- Concluzie: Cu un risc asumat de 5%, exista o diferenta semnificativa intre variantele celor doua grupuri (nou vs vechi)

Deci setam equal_var la False:

```{r}
t.test(Pret_mp ~ Vechime_Imobil, 
       data = df, 
       subset = Vechime_Imobil %in% c("Nou (Post-2000)", "Vechi (Pre-1977)"),
       var.equal = F)
```

### Interpretare

Ipoteze:

- H0: m_{pret_noi} = m_{pret_vechi}

- H1: m_{pret_noi} != m_{pret_vechi}

p-value = 0.9 > 0.05, nu respingem ipoteza nula H0

Concluzie:

Nu sunt destule dovezi statistice care sa arate ca pretul mediu pe mp la apartamentele noi difera semnificativ de pretul mediu pe mp la apartamentele vechi

Cele doua medii nu difera semnificativ, la un nivel de semnificatie de 5%

### Traducere

Ne-am fi asteptat ca mediile sa difere semnificativ, dar am primit ca rezultat ca sunt chiar foarte asemenatoare cu o valoare foarte mare de 0.9

De ce ?

- Locatia: Multe apartamente Vechi sunt in Centru, Copou, Podu Ros, in timp ce multe apartamente Noi sunt la periferie. Pamantul e mai scump in Copou decat la periferie, deci locatia bate vechimea, iar mediile se echilibreaza

- Renovarile: Apartamentele vechi scoase la vanzare sunt adesea renovate la conditii de lux, crescand pretul pe mp

Aceste doua explicatii ar putea conduce la echilibrarea mediilor

# Concluzii

Acest studiu a analizat mecanismele de formare a preturilor pe piata imobiliara din Iasi folosind un esantion de 520 apartamente obtinute 
prin web scraping de pe Storia.

## Constatari principale:

### 1. Predictori ai pretului

**Suprafata utila** este cel mai puternic predictor individual al pretului, explicand singura 74% din variatia preturilor. Relatia este pozitiva si liniara: fiecare metru patrat adaugat creste pretul mediu cu aproximativ 1,742 EUR.

**Modelul multiplu** (Suprafata + Camere + Tip_Zona) imbunatateste capacitatea de predictie la 76.4% (R squared ajustat = 0.762), confirmand ca locatia si numarul de camere aduc valoare informationala in plus fata de modelul simplu unde aveam doar suprafata utila.

### 2. Impactul zonei geografice

**Zona Premium** (Copou-Centru) adauga in medie 11,258 EUR la pretul unui apartament, fiind a doua cea mai puternica variabila dupa suprafata.

**Zona Standard/Urban** nu difera semnificativ de zona Accesibil/Rezidential, sugerand ca zonele precum Tatarasi, Podu Ros si Alexandru au preturi comparabile cu Nicolina si Galata.

**Zona Periferie** este in medie cu 6,599 EUR mai ieftina decat zona accesibila. 

### 3. Corelatii si relatii bivariante

Toate corelatiile testate sunt **semnificative statistic**:

- **Pret - Suprafata_Utila**: r = 0.86 (corelatie pozitiva foarte puternica)
- **Pret - Camere**: r = 0.71 (corelatie pozitiva puternica)
- **Suprafata_Utila - Camere**: r = 0.80 (corelatie pozitiva foarte puternica)

### 4. Descoperiri surprinzatoare

**a) Relatia Suprafata - Pret pe mp**

Am identificat o corelatie negativa slaba intre suprafata si pretul pe metru patrat (r = -0.11). Acest rezultat aparent contradictoriu reflecta o realitate economica: apartamentele mici (garsoniere) au costuri fixe concentrate pe suprafata mica, rezultand un pret/mp mai mare, in timp ce apartamentele mari distribuie aceste costuri pe mai multi mp.

Analiza segmentata pe zona Accesibil/Rezidential confirma aceasta tendinta, corelația devenind mai puternica (r = -0.26) atunci cand sunt eliminate apartamentele de lux.

**b) Pretul pe mp: Apartamente Noi vs Vechi**

Testul t pentru esantioane independente a aratat ca nu exista diferente semnificative intre pretul mediu pe mp al apartamentelor noi si vechi (p = 0.9). Acest rezultat surprinzator se explica prin:

- Efectul locatiei: Multe apartamente vechi sunt situate in zone premium (Copou, Centru), in timp ce apartamentele noi sunt adesea la periferie

- Renovarile: Apartamentele vechi scoase la vanzare sunt frecvent renovate la standarde moderne, crescand pretul pe mp

Ca idee scurta: **Locatia bate vechimea**

### 5. Limitari ale modelelor

- **Heteroscedasticitate moderata**: Modelul de regresie multipla face erori mai mari pentru apartamentele scumpe (peste 120,000 EUR), dispersia reziduurilor crescand odata cu pretul estimat

- **Abateri minore de la normalitate**: Testul Shapiro-Wilk respinge H0 (p = 0.017), insa W = 0.993 sugereaza practic abateri nesemnificative 

- **Variabila nesemnificativa**: Zona Standard/Urban nu aduce valoare predictiva (p = 0.9) fata de zona de referinta Accesibil/Rezidential

### Pentru cumparatori interesati de un apartament in Iasi:

- Suprafata si locatia sunt cei mai importanti factori ai pretului

- Apartamentele vechi renovate in zone centrale pot fi la fel de valoroase ca apartamentele noi de la periferia orasului

- Apartamentele mici (garsonierele) au un cost pe mp disproportionat de mare
